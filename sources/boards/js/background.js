(function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=typeof require=="function"&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}var f=typeof require=="function"&&require;for(var g=0;g<d.length;g++)e(d[g]);return e})({1:[function(a,b,c){b.exports=a("./src")},{"./src":15}],2:[function(a,b,c){"use strict";function d(a,b,c){this.fn=a;this.context=b;this.once=c||false}function e(){}e.prototype._events=undefined;e.prototype.listeners=function f(a){if(!this._events||!this._events[a])return[];if(this._events[a].fn)return[this._events[a].fn];for(var b=0,c=this._events[a].length,d=new Array(c);b<c;b++){d[b]=this._events[a][b].fn}return d};e.prototype.emit=function g(a,b,c,d,e,f){if(!this._events||!this._events[a])return false;var g=this._events[a],h=arguments.length,i,j;if("function"===typeof g.fn){if(g.once)this.removeListener(a,g.fn,true);switch(h){case 1:return g.fn.call(g.context),true;case 2:return g.fn.call(g.context,b),true;case 3:return g.fn.call(g.context,b,c),true;case 4:return g.fn.call(g.context,b,c,d),true;case 5:return g.fn.call(g.context,b,c,d,e),true;case 6:return g.fn.call(g.context,b,c,d,e,f),true}for(j=1,i=new Array(h-1);j<h;j++){i[j-1]=arguments[j]}g.fn.apply(g.context,i)}else{var k=g.length,l;for(j=0;j<k;j++){if(g[j].once)this.removeListener(a,g[j].fn,true);switch(h){case 1:g[j].fn.call(g[j].context);break;case 2:g[j].fn.call(g[j].context,b);break;case 3:g[j].fn.call(g[j].context,b,c);break;default:if(!i)for(l=1,i=new Array(h-1);l<h;l++){i[l-1]=arguments[l]}g[j].fn.apply(g[j].context,i)}}}return true};e.prototype.on=function h(a,b,c){var e=new d(b,c||this);if(!this._events)this._events={};if(!this._events[a])this._events[a]=e;else{if(!this._events[a].fn)this._events[a].push(e);else this._events[a]=[this._events[a],e]}return this};e.prototype.once=function i(a,b,c){var e=new d(b,c||this,true);if(!this._events)this._events={};if(!this._events[a])this._events[a]=e;else{if(!this._events[a].fn)this._events[a].push(e);else this._events[a]=[this._events[a],e]}return this};e.prototype.removeListener=function j(a,b,c){if(!this._events||!this._events[a])return this;var d=this._events[a],e=[];if(b){if(d.fn&&(d.fn!==b||c&&!d.once)){e.push(d)}if(!d.fn)for(var f=0,g=d.length;f<g;f++){if(d[f].fn!==b||c&&!d[f].once){e.push(d[f])}}}if(e.length){this._events[a]=e.length===1?e[0]:e}else{delete this._events[a]}return this};e.prototype.removeAllListeners=function k(a){if(!this._events)return this;if(a)delete this._events[a];else this._events={};return this};e.prototype.off=e.prototype.removeListener;e.prototype.addListener=e.prototype.on;e.prototype.setMaxListeners=function l(){return this};e.EventEmitter=e;e.EventEmitter2=e;e.EventEmitter3=e;b.exports=e},{}],3:[function(a,b,c){(function(a){!function(a,c,d){c[a]=c[a]||d(),"undefined"!=typeof b&&b.exports?b.exports=c[a]:"function"==typeof define&&define.amd&&define(function(){return c[a]})}("Promise","undefined"!=typeof a?a:this,function(){"use strict";function a(a,b){m.add(a,b),l||(l=o(m.drain))}function b(a){var b,c=typeof a;return null==a||"object"!=c&&"function"!=c||(b=a.then),"function"==typeof b?b:!1}function c(){for(var a=0;a<this.chain.length;a++)d(this,1===this.state?this.chain[a].success:this.chain[a].failure,this.chain[a]);this.chain.length=0}function d(a,c,d){var e,f;try{c===!1?d.reject(a.msg):(e=c===!0?a.msg:c.call(void 0,a.msg),e===d.promise?d.reject(TypeError("Promise-chain cycle")):(f=b(e))?f.call(e,d.resolve,d.reject):d.resolve(e))}catch(g){d.reject(g)}}function e(d){var g,i,j=this;if(!j.triggered){j.triggered=!0,j.def&&(j=j.def);try{(g=b(d))?(i=new h(j),g.call(d,function(){e.apply(i,arguments)},function(){f.apply(i,arguments)})):(j.msg=d,j.state=1,j.chain.length>0&&a(c,j))}catch(k){f.call(i||new h(j),k)}}}function f(b){var d=this;d.triggered||(d.triggered=!0,d.def&&(d=d.def),d.msg=b,d.state=2,d.chain.length>0&&a(c,d))}function g(a,b,c,d){for(var e=0;e<b.length;e++)!function(e){a.resolve(b[e]).then(function(a){c(e,a)},d)}(e)}function h(a){this.def=a,this.triggered=!1}function i(a){this.promise=a,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function j(b){if("function"!=typeof b)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var d=new i(this);this.then=function(b,e){var f={success:"function"==typeof b?b:!0,failure:"function"==typeof e?e:!1};return f.promise=new this.constructor(function(a,b){if("function"!=typeof a||"function"!=typeof b)throw TypeError("Not a function");f.resolve=a,f.reject=b}),d.chain.push(f),0!==d.state&&a(c,d),f.promise},this["catch"]=function(a){return this.then(void 0,a)};try{b.call(void 0,function(a){e.call(d,a)},function(a){f.call(d,a)})}catch(g){f.call(d,g)}}var k,l,m,n=Object.prototype.toString,o="undefined"!=typeof setImmediate?function(a){return setImmediate(a)}:setTimeout;try{Object.defineProperty({},"x",{}),k=function(a,b,c,d){return Object.defineProperty(a,b,{value:c,writable:!0,configurable:d!==!1})}}catch(p){k=function(a,b,c){return a[b]=c,a}}m=function(){function a(a,b){this.fn=a,this.self=b,this.next=void 0}var b,c,d;return{add:function(e,f){d=new a(e,f),c?c.next=d:b=d,c=d,d=void 0},drain:function(){var a=b;for(b=c=l=void 0;a;)a.fn.call(a.self),a=a.next}}}();var q=k({},"constructor",j,!1);return k(j,"prototype",q,!1),k(q,"__NPO__",0,!1),k(j,"resolve",function(a){var b=this;return a&&"object"==typeof a&&1===a.__NPO__?a:new b(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");b(a)})}),k(j,"reject",function(a){return new this(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");c(a)})}),k(j,"all",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):0===a.length?b.resolve([]):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");var e=a.length,f=Array(e),h=0;g(b,a,function(a,b){f[a]=b,++h===e&&c(f)},d)})}),k(j,"race",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");g(b,a,function(a,b){c(b)},d)})}),j})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],4:[function(a,b,c){b.exports={}},{}],5:[function(a,b,c){c.createdStores=[];c.createdActions=[];c.reset=function(){while(c.createdStores.length){c.createdStores.pop()}while(c.createdActions.length){c.createdActions.pop()}}},{}],6:[function(a,b,c){var d=a("./utils"),e=a("./joins").instanceJoinCreator;var f=function(a){var b=0,c={},d;for(;b<(a.children||[]).length;++b){d=a.children[b];if(a[d]){c[d]=a[d]}}return c};var g=function(a){var b={};for(var c in a){var e=a[c];var h=f(e);var i=g(h);b[c]=e;for(var j in i){var k=i[j];b[c+d.capitalize(j)]=k}}return b};b.exports={hasListener:function(a){var b=0,c,d,e;for(;b<(this.subscriptions||[]).length;++b){e=[].concat(this.subscriptions[b].listenable);for(c=0;c<e.length;c++){d=e[c];if(d===a||d.hasListener&&d.hasListener(a)){return true}}}return false},listenToMany:function(a){var b=g(a);for(var c in b){var e=d.callbackName(c),f=this[e]?e:this[c]?c:undefined;if(f){this.listenTo(b[c],f,this[e+"Default"]||this[f+"Default"]||f)}}},validateListening:function(a){if(a===this){return"Listener is not able to listen to itself"}if(!d.isFunction(a.listen)){return a+" is missing a listen method"}if(a.hasListener&&a.hasListener(this)){return"Listener cannot listen to this listenable because of circular loop"}},listenTo:function(a,b,c){var e,f,g,h=this.subscriptions=this.subscriptions||[];d.throwIf(this.validateListening(a));this.fetchInitialState(a,c);e=a.listen(this[b]||b,this);f=function(){var a=h.indexOf(g);d.throwIf(a===-1,"Tried to remove listen already gone from subscriptions list!");h.splice(a,1);e()};g={stop:f,listenable:a};h.push(g);return g},stopListeningTo:function(a){var b,c=0,e=this.subscriptions||[];for(;c<e.length;c++){b=e[c];if(b.listenable===a){b.stop();d.throwIf(e.indexOf(b)!==-1,"Failed to remove listen from subscriptions list!");return true}}return false},stopListeningToAll:function(){var a,b=this.subscriptions||[];while(a=b.length){b[0].stop();d.throwIf(b.length!==a-1,"Failed to remove listen from subscriptions list!")}},fetchInitialState:function(a,b){b=b&&this[b]||b;var c=this;if(d.isFunction(b)&&d.isFunction(a.getInitialState)){var e=a.getInitialState();if(e&&d.isFunction(e.then)){e.then(function(){b.apply(c,arguments)})}else{b.call(this,e)}}},joinTrailing:e("last"),joinLeading:e("first"),joinConcat:e("all"),joinStrict:e("strict")}},{"./joins":16,"./utils":20}],7:[function(a,b,c){var d=a("./utils"),e=a("./ListenerMethods");b.exports=d.extend({componentWillUnmount:e.stopListeningToAll},e)},{"./ListenerMethods":6,"./utils":20}],8:[function(a,b,c){var d=a("./utils");b.exports={preEmit:function(){},shouldEmit:function(){return true},listen:function(a,b){b=b||this;var c=function(c){a.apply(b,c)},d=this;this.emitter.addListener(this.eventLabel,c);return function(){d.emitter.removeListener(d.eventLabel,c)}},promise:function(a){var b=this;var c=this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0;if(!c){throw new Error('Publisher must have "completed" and "failed" child publishers')}a.then(function(a){return b.completed(a)},function(a){return b.failed(a)})},listenAndPromise:function(a,b){var c=this;b=b||this;return this.listen(function(){if(!a){throw new Error("Expected a function returning a promise but got "+a)}var d=arguments,e=a.apply(b,d);return c.promise.call(c,e)},b)},trigger:function(){var a=arguments,b=this.preEmit.apply(this,a);a=b===undefined?a:d.isArguments(b)?b:[].concat(b);if(this.shouldEmit.apply(this,a)){this.emitter.emit(this.eventLabel,a)}},triggerAsync:function(){var a=arguments,b=this;d.nextTick(function(){b.trigger.apply(b,a)})},triggerPromise:function(){var a=this;var b=arguments;var c=this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0;var e=d.createPromise(function(d,e){if(c){var f=a.completed.listen(function(a){f();g();d(a)});var g=a.failed.listen(function(a){f();g();e(a)})}a.triggerAsync.apply(a,b);if(!c){d()}});return e}}},{"./utils":20}],9:[function(a,b,c){b.exports={}},{}],10:[function(a,b,c){b.exports=function(a,b){for(var c in b){if(Object.getOwnPropertyDescriptor&&Object.defineProperty){var d=Object.getOwnPropertyDescriptor(b,c);if(!d.value||typeof d.value!=="function"||!b.hasOwnProperty(c)){continue}a[c]=b[c].bind(a)}else{var e=b[c];if(typeof e!=="function"||!b.hasOwnProperty(c)){continue}a[c]=e.bind(a)}}return a}},{}],11:[function(a,b,c){var d=a("./index"),e=a("./utils");b.exports=function(a,b){return{getInitialState:function(){if(!e.isFunction(a.getInitialState)){return{}}else if(b===undefined){return a.getInitialState()}else{return e.object([b],[a.getInitialState()])}},componentDidMount:function(){e.extend(this,d.ListenerMethods);var c=this,f=b===undefined?this.setState:function(a){c.setState(e.object([b],[a]))};this.listenTo(a,f)},componentWillUnmount:d.ListenerMixin.componentWillUnmount}}},{"./index":15,"./utils":20}],12:[function(a,b,c){var d=a("./index"),e=a("./utils");b.exports=function(a,b,c){c=e.isFunction(b)?b:c;return{getInitialState:function(){if(!e.isFunction(a.getInitialState)){return{}}else if(e.isFunction(b)){return c.call(this,a.getInitialState())}else{var d=c.call(this,a.getInitialState());if(d){return e.object([b],[d])}else{return{}}}},componentDidMount:function(){e.extend(this,d.ListenerMethods);var f=this;var g=function(a){if(e.isFunction(b)){f.setState(c.call(f,a))}else{var d=c.call(f,a);f.setState(e.object([b],[d]))}};this.listenTo(a,g)},componentWillUnmount:d.ListenerMixin.componentWillUnmount}}},{"./index":15,"./utils":20}],13:[function(a,b,c){var d=a("./utils"),e=a("./index"),f=a("./Keep"),g={preEmit:1,shouldEmit:1};var h=function(a){a=a||{};if(!d.isObject(a)){a={actionName:a}}for(var b in e.ActionMethods){if(!g[b]&&e.PublisherMethods[b]){throw new Error("Cannot override API method "+b+" in Reflux.ActionMethods. Use another method name or override it on Reflux.PublisherMethods instead.")}}for(var c in a){if(!g[c]&&e.PublisherMethods[c]){throw new Error("Cannot override API method "+c+" in action creation. Use another method name or override it on Reflux.PublisherMethods instead.")}}a.children=a.children||[];if(a.asyncResult){a.children=a.children.concat(["completed","failed"])}var i=0,j={};for(;i<a.children.length;i++){var k=a.children[i];j[k]=h(k)}var l=d.extend({eventLabel:"action",emitter:new d.EventEmitter,_isAction:true},e.PublisherMethods,e.ActionMethods,a);var m=function(){return m[m.sync?"trigger":"triggerPromise"].apply(m,arguments)};d.extend(m,j,l);f.createdActions.push(m);return m};b.exports=h},{"./Keep":5,"./index":15,"./utils":20}],14:[function(a,b,c){var d=a("./utils"),e=a("./index"),f=a("./Keep"),g=a("./mixer"),h={preEmit:1,shouldEmit:1},i=a("./bindMethods");b.exports=function(a){a=a||{};for(var b in e.StoreMethods){if(!h[b]&&(e.PublisherMethods[b]||e.ListenerMethods[b])){throw new Error("Cannot override API method "+b+" in Reflux.StoreMethods. Use another method name or override it on Reflux.PublisherMethods / Reflux.ListenerMethods instead.")}}for(var c in a){if(!h[c]&&(e.PublisherMethods[c]||e.ListenerMethods[c])){throw new Error("Cannot override API method "+c+" in store creation. Use another method name or override it on Reflux.PublisherMethods / Reflux.ListenerMethods instead.")}}a=g(a);function j(){var b=0,c;this.subscriptions=[];this.emitter=new d.EventEmitter;this.eventLabel="change";i(this,a);if(this.init&&d.isFunction(this.init)){this.init()}if(this.listenables){c=[].concat(this.listenables);for(;b<c.length;b++){this.listenToMany(c[b])}}}d.extend(j.prototype,e.ListenerMethods,e.PublisherMethods,e.StoreMethods,a);var k=new j;f.createdStores.push(k);return k}},{"./Keep":5,"./bindMethods":10,"./index":15,"./mixer":19,"./utils":20}],15:[function(a,b,c){c.ActionMethods=a("./ActionMethods");c.ListenerMethods=a("./ListenerMethods");c.PublisherMethods=a("./PublisherMethods");c.StoreMethods=a("./StoreMethods");c.createAction=a("./createAction");c.createStore=a("./createStore");c.connect=a("./connect");c.connectFilter=a("./connectFilter");c.ListenerMixin=a("./ListenerMixin");c.listenTo=a("./listenTo");c.listenToMany=a("./listenToMany");var d=a("./joins").staticJoinCreator;c.joinTrailing=c.all=d("last");c.joinLeading=d("first");c.joinStrict=d("strict");c.joinConcat=d("all");var e=a("./utils");c.EventEmitter=e.EventEmitter;c.Promise=e.Promise;c.createActions=function(a){var b={};for(var d in a){var f=a[d],g=e.isObject(f)?d:f;b[g]=c.createAction(f)}return b};c.setEventEmitter=function(b){var d=a("./utils");c.EventEmitter=d.EventEmitter=b};c.setPromise=function(b){var d=a("./utils");c.Promise=d.Promise=b};c.setPromiseFactory=function(b){var c=a("./utils");c.createPromise=b};c.nextTick=function(b){var c=a("./utils");c.nextTick=b};c.__keep=a("./Keep");if(!Function.prototype.bind){console.error("Function.prototype.bind not available. "+"ES5 shim required. "+"https://github.com/spoike/refluxjs#es5")}},{"./ActionMethods":4,"./Keep":5,"./ListenerMethods":6,"./ListenerMixin":7,"./PublisherMethods":8,"./StoreMethods":9,"./connect":11,"./connectFilter":12,"./createAction":13,"./createStore":14,"./joins":16,"./listenTo":17,"./listenToMany":18,"./utils":20}],16:[function(a,b,c){var d=Array.prototype.slice,e=a("./utils"),f=a("./createStore"),g={strict:"joinStrict",first:"joinLeading",last:"joinTrailing",all:"joinConcat"};c.staticJoinCreator=function(a){return function(){var b=d.call(arguments);return f({init:function(){this[g[a]].apply(this,b.concat("triggerAsync"))}})}};c.instanceJoinCreator=function(a){return function(){e.throwIf(arguments.length<3,"Cannot create a join with less than 2 listenables!");var b=d.call(arguments),c=b.pop(),f=b.length,g={numberOfListenables:f,callback:this[c]||c,listener:this,strategy:a},k,l=[],m;for(k=0;k<f;k++){e.throwIf(this.validateListening(b[k]))}for(k=0;k<f;k++){l.push(b[k].listen(j(k,g),this))}i(g);m={listenable:b};m.stop=h(m,l,this);this.subscriptions=(this.subscriptions||[]).concat(m);return m}};function h(a,b,c){return function(){var d,f=c.subscriptions,g=f?f.indexOf(a):-1;e.throwIf(g===-1,"Tried to remove join already gone from subscriptions list!");for(d=0;d<b.length;d++){b[d]()}f.splice(g,1)}}function i(a){a.listenablesEmitted=new Array(a.numberOfListenables);a.args=new Array(a.numberOfListenables)}function j(a,b){return function(){var c=d.call(arguments);if(b.listenablesEmitted[a]){switch(b.strategy){case"strict":throw new Error("Strict join failed because listener triggered twice.");case"last":b.args[a]=c;break;case"all":b.args[a].push(c)}}else{b.listenablesEmitted[a]=true;b.args[a]=b.strategy==="all"?[c]:c}k(b)}}function k(a){for(var b=0;b<a.numberOfListenables;b++){if(!a.listenablesEmitted[b]){return}}a.callback.apply(a.listener,a.args);i(a)}},{"./createStore":14,"./utils":20}],17:[function(a,b,c){var d=a("./index");b.exports=function(a,b,c){return{componentDidMount:function(){for(var e in d.ListenerMethods){if(this[e]!==d.ListenerMethods[e]){if(this[e]){throw"Can't have other property '"+e+"' when using Reflux.listenTo!"}this[e]=d.ListenerMethods[e]}}this.listenTo(a,b,c)},componentWillUnmount:d.ListenerMethods.stopListeningToAll}}},{"./index":15}],18:[function(a,b,c){var d=a("./index");b.exports=function(a){return{componentDidMount:function(){for(var b in d.ListenerMethods){if(this[b]!==d.ListenerMethods[b]){if(this[b]){throw"Can't have other property '"+b+"' when using Reflux.listenToMany!"}this[b]=d.ListenerMethods[b]}}this.listenToMany(a)},componentWillUnmount:d.ListenerMethods.stopListeningToAll}}},{"./index":15}],19:[function(a,b,c){var d=a("./utils");b.exports=function e(a){var b={init:[],preEmit:[],shouldEmit:[]};var c=function e(a){var c={};if(a.mixins){a.mixins.forEach(function(a){d.extend(c,e(a))})}d.extend(c,a);Object.keys(b).forEach(function(c){if(a.hasOwnProperty(c)){b[c].push(a[c])}});return c}(a);if(b.init.length>1){c.init=function(){var a=arguments;b.init.forEach(function(b){b.apply(this,a)},this)}}if(b.preEmit.length>1){c.preEmit=function(){return b.preEmit.reduce(function(a,b){var c=b.apply(this,a);return c===undefined?a:[c]}.bind(this),arguments)}}if(b.shouldEmit.length>1){c.shouldEmit=function(){var a=arguments;return!b.shouldEmit.some(function(b){return!b.apply(this,a)},this)}}Object.keys(b).forEach(function(a){if(b[a].length===1){c[a]=b[a][0]}});return c}},{"./utils":20}],20:[function(a,b,c){var d=c.isObject=function(a){var b=typeof a;return b==="function"||b==="object"&&!!a};c.extend=function(a){if(!d(a)){return a}var b,c;for(var e=1,f=arguments.length;e<f;e++){b=arguments[e];for(c in b){if(Object.getOwnPropertyDescriptor&&Object.defineProperty){var g=Object.getOwnPropertyDescriptor(b,c);Object.defineProperty(a,c,g)}else{a[c]=b[c]}}}return a};c.isFunction=function(a){return typeof a==="function"};c.EventEmitter=a("eventemitter3");c.nextTick=function(a){setTimeout(a,0)};c.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};c.callbackName=function(a){return"on"+c.capitalize(a)};c.object=function(a,b){var c={},d=0;for(;d<a.length;d++){c[a[d]]=b[d]}return c};c.Promise=a("native-promise-only");c.createPromise=function(a){return new c.Promise(a)};c.isArguments=function(a){return typeof a==="object"&&"callee"in a&&typeof a.length==="number"};c.throwIf=function(a,b){if(a){throw Error(b||a)}}},{eventemitter3:2,"native-promise-only":3}],21:[function(a,b,c){"use strict";var d=a("./stores/BoardStore");var e=a("./stores/SettingsStore");var f=a("./stores/NotificationStore");var g=a("./utils");g.refreshTrelloData(true);setInterval(function(){g.refreshTrelloData()},5*60*1e3);e.registerInstall();chrome.runtime.onConnectExternal.addListener(function(a){if(a.sender.id!==g.newTabForTrelloExtensionId()){return}a.postMessage(d.getNewTabMessageData());var b=d.listen(function(){a.postMessage(d.getNewTabMessageData())});a.onDisconnect.addListener(function(){b()});g.refreshTrelloData()})},{"./stores/BoardStore":22,"./stores/NotificationStore":24,"./stores/SettingsStore":25,"./utils":26}],22:[function(a,b,c){"use strict";var d=a("reflux");var e=a("./../utils");var f=a("./MessageStore");var g=a("./SettingsStore");var h=d.createStore({init:function(){this.setInitialState();chrome.storage.local.get(e.keys(this.data),function(a){this.receiveStorageUpdate(a)}.bind(this));chrome.storage.onChanged.addListener(function(a,b){this.receiveStorageUpdate(a,true)}.bind(this))},setInitialState:function(){this.data={member:{},boards:[],boardStars:[],organizations:[]};this.loaded=false;this.starredBoards=[];this.myBoards=[]},receiveStorageUpdate:function(a,b){for(var c in a){if(this.data.hasOwnProperty(c)){this.data[c]=b?a[c].newValue:a[c]}}this.loaded=true;this.triggerDataChange()},triggerDataChange:function(){this.data.boardStars.sort(function(a,b){return a.pos-b.pos});this.starredBoards=this.data.boardStars.map(function(a){return this.data.boards.filter(function(b){return a.idBoard===b.id})[0]}.bind(this)).filter(function(a){return!!a});var a=this.data.member.idBoards||[];this.myBoards=this.data.boards.filter(function(b){return!b.organization&&a.indexOf(b.id)>-1});this.trigger()},getStarredBoards:function(){return this.starredBoards||[]},getMyBoards:function(){return this.myBoards||[]},getBoards:function(){return this.data.boards},getOrgs:function(){return this.data.organizations},getMember:function(){return this.data.member},getLoaded:function(){return this.loaded},getNewTabMessageData:function(){var a=[],b=true,c=g.isPro();if(c&&this.data.boards.length){b=false;a.push({org:"starred",boards:this.getStarredBoards()});a.push({org:"my",boards:this.getMyBoards()});var d=this.getBoards();a=a.concat(this.getOrgs().map(function(a){return{org:a,boards:d.filter(function(b){return a.id===b.idOrganization})}}))}return{boardLists:a,boardListsEmpty:b,isLoaded:this.getLoaded(),isAuthorised:g.isAuthorised(),isPro:c}},toggleBoardStar:function(a){var b=this.data.boards.filter(function(b){return a===b.id})[0];if(!b){return}if(b.starred){this.unstarBoard(b)}else{this.starBoard(b)}},starBoard:function(a){a.starred=true;var b={idBoard:a.id,pos:4294967295};this.data.boardStars.push(b);Trello.post("/members/me/boardStars",{idBoard:a.id,pos:"bottom"},function(a){b.id=a.id;b.pos=a.pos;chrome.storage.local.set({boardStars:this.data.boardStars})}.bind(this),function(){a.starred=false;this.data.boardStars.splice(this.data.boardStars.indexOf(b),1);chrome.storage.local.set({boardStars:this.data.boardStars});f.flashError("Sorry! There was a problem starring your board. Check your Internet connection and try again.")}.bind(this))},unstarBoard:function(a){var b=this.data.boardStars.filter(function(b){return a.id===b.idBoard})[0];if(!b){return}a.starred=false;var c=this.data.boardStars.indexOf(b);this.data.boardStars.splice(c,1);chrome.storage.local.set({boardStars:this.data.boardStars});Trello.del("/members/me/boardStars/"+b.id,function(){},function(d){a.starred=true;this.data.boardStars.splice(c,0,b);chrome.storage.local.set({boardStars:this.data.boardStars});var e="Check your connection and try again.";if(429===d.status){e="Too many requests - try again soon."}f.flashError("There was a problem removing the board's star. "+e)}.bind(this))}});b.exports=h;function i(a){var b=5381,c=a.length;while(c)b=b*33^a.charCodeAt(--c);return b>>>0}},{"./../utils":26,"./MessageStore":23,"./SettingsStore":25,reflux:1}],23:[function(a,b,c){"use strict";var d=a("reflux");var e=d.createStore({init:function(){this.messages=[];this.id=0},flash:function(a,b,c){var d={id:this.id++,type:a,message:b};this.messages.push(d);this.trigger();if(!c){setTimeout(this.hide.bind(this,d),3500)}return d},flashError:function(a){this.flash("error",a)},hide:function(a){this.messages.splice(this.messages.indexOf(a),1);this.trigger()},getMessages:function(){return this.messages||[]}});b.exports=e},{reflux:1}],24:[function(a,b,c){"use strict";var d=a("reflux");var e=a("./../utils");var f=a("./SettingsStore");var g=d.createStore({init:function(){this.notifications=[];this.notification_count="";this.markAsReadState=null;chrome.storage.local.get("notifications",function(a){if("notifications"in a){this.receiveStorageUpdate(a.notifications)}}.bind(this));chrome.storage.onChanged.addListener(function(a,b){if("notifications"in a){this.receiveStorageUpdate(a.notifications.newValue)}}.bind(this))},receiveStorageUpdate:function(a){a=a||[];var b=a.filter(function(a){return a.unread});this.notifications=a;this.notification_count=b.length?b.length.toString():"";if(this.notification_count){this.markAsReadState="can"}else{this.markAsReadState=null}this.trigger();this.updateNotificationBadgeDisplay()},updateNotificationBadgeDisplay:function(){if(!f.enableNotifications()){chrome.browserAction.setBadgeText({text:""});return}chrome.browserAction.setBadgeText({text:this.notification_count})},markAllNotificationsAsRead:function(){this.markAsReadState=null;this.trigger();e.markAllRead(function(){this.markAsReadState=null;this.trigger()}.bind(this),function(){this.markAsReadState="error";this.trigger()}.bind(this))},markSingleNotificationAsRead:function(a){e.markSingleNotifAsRead(a)},getNotifications:function(){return this.notifications},getUnreadNotificationCount:function(){return this.notification_count},getMarkAsReadState:function(){return this.markAsReadState}});b.exports=g},{"./../utils":26,"./SettingsStore":25,reflux:1}],25:[function(a,b,c){"use strict";var d=a("reflux");var e=a("./../utils");var f=d.createStore({init:function(){this._is_pro=false;this._loaded=false;this._checking_pro=false;this._enable_notificaitons="disable"!==localStorage.getItem("trello_disable_notif_count");this._pro_reason=localStorage.getItem("tb_pro_reason");chrome.storage.sync.get("3b8ff43091bae53a1450ce2fac9f07a6",function(a){this._setPro(!!a["3b8ff43091bae53a1450ce2fac9f07a6"])}.bind(this));chrome.storage.onChanged.addListener(function(a){if("3b8ff43091bae53a1450ce2fac9f07a6"in a){this._setPro(a["3b8ff43091bae53a1450ce2fac9f07a6"].newValue)}}.bind(this))},clobber:function(){localStorage.clear();chrome.storage.local.clear();chrome.storage.sync.clear()},_setPro:function(a){this._is_pro=a;this._loaded=true;this.trigger();if("function"===typeof ga){ga("set","dimension1",a?"pro":"free")}},isPro:function(){return this._is_pro},getProReason:function(){return this._pro_reason},isCheckingPro:function(){return this._checking_pro},getLoaded:function(){return this._loaded},isAuthorised:function(){if(!localStorage.getItem("trello_token_full")){localStorage.setItem("trello_token_full",new Date);localStorage.removeItem("trello_token");return false}return!!localStorage.getItem("trello_token")},proFeatureStrings:function(){return["View Trello notifications","Mark notifications as read","View boards as the New Tab Page","Star / unstar boards","Hide organization board lists","Free upgrades for life"]},enableNotifications:function(a){if(true===a){localStorage.removeItem("trello_disable_notif_count");this._enable_notificaitons=a;this.trigger()}else if(false===a){localStorage.setItem("trello_disable_notif_count","disable");this._enable_notificaitons=a;this.trigger();chrome.browserAction.setBadgeText({text:""})}return this._enable_notificaitons},oneTimeRefreshLiveLicenceData:function(){if(!localStorage.getItem("tb_pro_check")){this.refreshLiveLicenceData()}},refreshLiveLicenceData:function(){if(!this.isAuthorised()){return}this._checking_pro=true;this.trigger();var b=a("./BoardStore");var c=b.getMember();if(!c||!c.email){var d=b.listen(function(){var a=b.getMember();if(a&&a.email){d();this.refreshLiveLicenceData()}}.bind(this));e.refreshTrelloData();return}google.payments.inapp.getPurchases({parameters:{env:e.googlePaymentsEnv()},success:this._receiveLicenceData,failure:this._licenceDataFailed})},_receiveLicenceData:function(b){try{var c=b.response.details;for(var d=0;d<c.length;++d){var e=c[d];if("chromewebstore#payment"===e.kind&&/^pro/.test(e.sku)){if("ACTIVE"===e.state){this._becomePro();return}this._becomeFree()}}var f=a("./BoardStore");var g=f.getMember();if(!g||!g.email){this._checkProComplete();return}$.post("http://paulferrett.com/tblic.php",{email:g.email},function(a){if(a&&a.pro){this._becomePro(a.reason)}}.bind(this),"json").always(function(){this._checkProComplete()}.bind(this))}catch(h){console.error("error receiving licence data from Google Wallet",h)}},_becomePro:function(a){chrome.storage.sync.get("3b8ff43091bae53a1450ce2fac9f07a6",function(b){var c=!b["3b8ff43091bae53a1450ce2fac9f07a6"];if(c){chrome.storage.sync.set({"3b8ff43091bae53a1450ce2fac9f07a6":true});this._is_pro=true;if(a){this._pro_reason=a;localStorage.setItem("tb_pro_reason",a)}this._checkProComplete();this.registerInstall(true);e.chromeBadgeMarquee("Thanks for upgrading to PRO!",true)}}.bind(this))},_becomeFree:function(){chrome.storage.sync.get("3b8ff43091bae53a1450ce2fac9f07a6",function(a){var b=!!a["3b8ff43091bae53a1450ce2fac9f07a6"];if(b){chrome.storage.sync.set({"3b8ff43091bae53a1450ce2fac9f07a6":false});this._is_pro=false;this._checkProComplete();this.registerInstall(true)}}.bind(this))},_licenceDataFailed:function(){this._checkProComplete("Failed to fetch licence data")},_checkProComplete:function(a){if(a){console.error(a)}else{localStorage.setItem("tb_pro_check",new Date)}this._checking_pro=false;this.trigger()},registerInstall:function(b){var c=a("./BoardStore");var d=c.getMember();if(!d||!d.email){var e=c.listen(function(){var a=c.getMember();if(!a||!a.email){return}e();this.doRegisterInstall(a,b)}.bind(this))}else{this.doRegisterInstall(d,b)}},doRegisterInstall:function(a,b){var c=chrome.runtime.getManifest().version;var d="tb_install_"+a.email+"_"+c;if(this.isPro())d+="_pro";if(!b&&localStorage.getItem(d)){return}$.post("http://paulferrett.com/tbsub.php",{email:a.email,name:a.fullName,username:a.username,id:a.id,install_version:c,is_pro:this.isPro()?1:0,languages:JSON.stringify(window.navigator.languages)}).done(function(){localStorage.setItem(d,new Date)}).fail(function(){localStorage.removeItem(d)})}});b.exports=f},{"./../utils":26,"./BoardStore":22,reflux:1}],26:[function(a,b,c){"use strict";var d={};d.chromeBadgeMarquee=function(a,b){function c(a){chrome.browserAction.setBadgeText({text:a})}chrome.browserAction.getBadgeText({},function(d){var e=4,f=b?a.length:a.length+e,g=150,h=0;for(var i=0;i<=f;++i){var j=i<e?0:i-e;var k=i<e?i:e;var l=a.substr(j,k+1);setTimeout(c.bind(this,l),g*h++)}setTimeout(c.bind(this,d),g*h+3e3)})};d.boardsForTrelloExtensionId=function(){return"eknhddnoflchkcccjgdddmnimjggiona"};d.newTabForTrelloExtensionId=function(){return"flhbeabcinhdnpbmapigmippphgfinga"};d.googlePaymentsEnv=function(){return"prod"};d.googlePaymentsSKU=function(){return"pro"};function e(a,b){var c=new Image;c.src="chrome-extension://"+a+"/images/1x1.gif";c.onload=function(){b(true)};c.onerror=function(){b(false)}}d.isBoardsForTrelloInstalled=function(a){e(d.boardsForTrelloExtensionId(),a)};d.isNewTabForTrelloInstalled=function(a){e(d.newTabForTrelloExtensionId(),a)};function f(){if(!localStorage.getItem("trello_token_full")){localStorage.setItem("trello_token_full",new Date);localStorage.removeItem("trello_token");return false}return!!localStorage.getItem("trello_token")}d.refreshTrelloData=function(a){if(!f()){return}var b="trello_api_lastfetch";if(!a){var c=Math.floor((new Date).getTime()/1e3)-parseInt(localStorage.getItem(b));if(c<5){return}}d.nextTick(function(){localStorage.setItem(b,Math.floor((new Date).getTime()/1e3));Trello.authorize();Trello.get("/members/me",{boards:"all",boardStars:"true",board_fields:"id,name,idOrganization,url,starred,closed,dateLastActivity,dateLastView,organization,prefs",board_organization:"true",organizations:"all",board_organization_fields:"displayName,logoHash,url",organization_fields:"displayName,logoHash,url",notifications:"all",notification_entities:"true"},function(a){chrome.storage.local.set({notifications:a.notifications,organizations:a.organizations,boardStars:a.boardStars,boards:a.boards.filter(function(a){return!a.closed
})});delete a.notifications;delete a.organizations;delete a.boardStars;delete a.boards;chrome.storage.local.set({member:a})},function(a){localStorage.removeItem(b);console.error(a)})}.bind(this))};d.markAllRead=function(a,b){Trello.authorize();Trello.post("/notifications/all/read",function(){g(null,false);a()},function(a){b(a)})};d.markSingleNotifAsRead=function(a,b,c){var d=false;Trello.authorize();Trello.put("/notifications/"+a+"/unread",{value:d},function(c){g(a,d);b&&b()},function(a){c&&c(a)})};function g(a,b){chrome.storage.local.get("notifications",function(c){if("notifications"in c){chrome.storage.local.set({notifications:c.notifications.map(function(c){if(!a||a==c.id){c.unread=b}return c})})}})}d.keys=function(a){var b=[];for(var c in a){if(a.hasOwnProperty(c)){b.push(c)}}return b};d.arrayClone=function(a){return a.slice(0)};d.nextTick=function(a){setTimeout(a,1)};b.exports=d},{}]},{},[21]);